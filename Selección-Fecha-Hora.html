<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AppSalón - Selección de Fecha y Hora</title>
    <style>
        /* Tus estilos existentes se mantienen igual */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6B46C1;
            --secondary: #38B2AC;
            --success: #48BB78;
            --error: #F56565;
            --warning: #ED8936;
            --text-primary: #2D3748;
            --text-secondary: #718096;
            --bg-main: #F7FAFC;
            --bg-white: #FFFFFF;
            --border: #E2E8F0;
            
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            
            --radius-sm: 8px;
            --radius-md: 12px;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(180deg, #6B46C1 0%, #5a38a3 100%);
            color: var(--text-primary);
            line-height: 1.5;
            margin: 0;
            min-height: 100vh;
            padding: 0;
        }

        .container {
            max-width: 430px;
            margin: 0 auto;
            background: linear-gradient(180deg, #6B46C1 0%, #5a38a3 100%);
            min-height: 100vh;
            padding-bottom: 100px;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: var(--space-md);
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            font-size: 20px;
            color: white;
            cursor: pointer;
            padding: var(--space-sm);
            min-width: 44px;
            min-height: 44px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .header-title {
            font-size: clamp(16px, 4.5vw, 18px);
            font-weight: 600;
            color: white;
        }

        .step-indicator {
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            padding: 4px 12px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }

        /* Content */
        .content {
            padding: var(--space-md);
        }

        /* Service Summary */
        .service-summary {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            margin-bottom: var(--space-md);
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: var(--space-md);
            align-items: center;
        }

        .service-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary) 0%, #5a38a3 100%);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }

        .service-info {
            flex: 1;
        }

        .service-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .service-details {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .service-price {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }

        /* Calendar Card */
        .calendar-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            margin-bottom: var(--space-md);
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: clamp(16px, 4.5vw, 18px);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .card-title-icon {
            font-size: 20px;
        }

        /* Calendar Header */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 2px solid var(--border);
        }

        .calendar-nav-btn {
            background: rgba(107, 70, 193, 0.1);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-weight: bold;
        }

        .calendar-nav-btn:hover:not(:disabled) {
            background: rgba(107, 70, 193, 0.2);
            transform: scale(1.1);
        }

        .calendar-nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .calendar-month-year {
            font-size: 17px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: 0.3px;
        }

        /* Calendar Grid */
        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: var(--space-xs);
            margin-bottom: var(--space-md);
        }

        .weekday {
            text-align: center;
            font-size: 13px;
            font-weight: 700;
            color: var(--primary);
            padding: var(--space-sm) 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            border: 2px solid transparent;
            color: var(--text-primary);
            font-weight: 600;
            position: relative;
            user-select: none;
        }

        .calendar-day:hover:not(.disabled):not(.other-month) {
            background: rgba(107, 70, 193, 0.1);
            transform: scale(1.08);
            border-color: var(--primary);
        }

        .calendar-day.disabled {
            color: #CBD5E0;
            background: #F7FAFC;
            cursor: not-allowed;
            font-weight: 400;
        }

        .calendar-day.other-month {
            color: #E2E8F0;
            background: transparent;
            font-weight: 400;
            cursor: default;
        }

        .calendar-day.today {
            border: 2px solid var(--secondary);
            background: rgba(56, 178, 172, 0.1);
        }

        .calendar-day.today:hover:not(.disabled) {
            background: rgba(56, 178, 172, 0.2);
        }

        .calendar-day.selected {
            background: var(--primary);
            color: white;
            font-weight: 700;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(107, 70, 193, 0.4);
        }

        .calendar-day.selected:hover {
            background: #5a38a3;
        }

        /* Time Slots */
        .time-slots-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            margin-bottom: var(--space-md);
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1);
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: all 0.4s ease-in-out;
        }

        .time-slots-card.active {
            max-height: 800px;
            opacity: 1;
        }

        .selected-date-display {
            background: rgba(107, 70, 193, 0.1);
            padding: var(--space-md);
            border-radius: var(--radius-sm);
            margin-bottom: var(--space-lg);
            text-align: center;
        }

        .selected-date-text {
            font-size: 15px;
            font-weight: 600;
            color: var(--primary);
        }

        .time-period {
            margin-bottom: var(--space-xl);
        }

        .time-period:last-child {
            margin-bottom: 0;
        }

        .period-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-secondary);
            margin-bottom: var(--space-md);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .period-icon {
            font-size: 18px;
        }

        .time-slots-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-sm);
        }

        .time-slot {
            padding: 14px 8px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            position: relative;
        }

        .time-slot:hover:not(.disabled) {
            border-color: var(--primary);
            background: rgba(107, 70, 193, 0.05);
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .time-slot.selected {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
            font-weight: 700;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(107, 70, 193, 0.4);
        }

        .time-slot.disabled {
            opacity: 0.3;
            cursor: not-allowed;
            background: var(--bg-main);
            color: var(--text-secondary);
        }

        /* Selection Summary */
        .selection-summary {
            background: linear-gradient(135deg, rgba(72, 187, 120, 0.1) 0%, rgba(56, 178, 172, 0.1) 100%);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            margin-bottom: var(--space-md);
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1);
            border: 2px solid var(--success);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease-out;
        }

        .selection-summary.show {
            opacity: 1;
            transform: translateY(0);
        }

        .summary-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--success);
            margin-bottom: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md) 0;
            border-bottom: 1px solid rgba(72, 187, 120, 0.2);
        }

        .summary-row:last-child {
            border-bottom: none;
        }

        .summary-label {
            font-size: 14px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-weight: 500;
        }

        .summary-value {
            font-size: 15px;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Fixed Bottom Bar */
        .fixed-bottom-bar {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 430px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            padding: var(--space-md);
            box-shadow: 0px -4px 20px rgba(0, 0, 0, 0.15);
            z-index: 1000;
        }

        .btn {
            width: 100%;
            padding: 16px 24px;
            border-radius: var(--radius-sm);
            font-size: 16px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            min-height: 52px;
            transition: all 0.3s;
            font-family: inherit;
            letter-spacing: 0.3px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #5a38a3;
            transform: translateY(-3px);
            box-shadow: 0px 6px 20px rgba(107, 70, 193, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: #A0AEC0;
        }

        /* Responsive */
        @media (max-width: 375px) {
            .calendar-card,
            .time-slots-card {
                padding: var(--space-md);
            }

            .calendar-day {
                font-size: 14px;
            }

            .time-slots-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .weekday {
                font-size: 11px;
            }
        }

        @media (max-width: 320px) {
            .content {
                padding: var(--space-sm);
            }

            .time-slots-grid {
                gap: 8px;
            }

            .time-slot {
                font-size: 14px;
                padding: 12px 6px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <button class="back-btn" onclick="history.back()">←</button>
                <div class="header-title">Seleccionar Fecha y Hora</div>
                <div class="step-indicator">Paso 1/2</div>
            </div>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Service Summary -->
            <div class="service-summary">
                <div class="service-icon" id="serviceIcon">✂️</div>
                <div class="service-info">
                    <div class="service-name" id="serviceName">Corte de Cabello Profesional</div>
                    <div class="service-details" id="serviceDetails">30 min • Centro</div>
                </div>
                <div class="service-price" id="servicePrice">$35.000</div>
            </div>

            <!-- Calendar Card -->
            <div class="calendar-card">
                <h2 class="card-title">
                    <span class="card-title-icon">📅</span>
                    Selecciona una fecha
                </h2>

                <div class="calendar-header">
                    <button class="calendar-nav-btn" id="prevMonth" aria-label="Mes anterior">‹</button>
                    <div class="calendar-month-year" id="monthYear"></div>
                    <button class="calendar-nav-btn" id="nextMonth" aria-label="Mes siguiente">›</button>
                </div>

                <div class="calendar-weekdays">
                    <div class="weekday">Dom</div>
                    <div class="weekday">Lun</div>
                    <div class="weekday">Mar</div>
                    <div class="weekday">Mié</div>
                    <div class="weekday">Jue</div>
                    <div class="weekday">Vie</div>
                    <div class="weekday">Sáb</div>
                </div>

                <div class="calendar-days" id="calendarDays"></div>
            </div>

            <!-- Time Slots Card -->
            <div class="time-slots-card" id="timeSlotsCard">
                <h2 class="card-title">
                    <span class="card-title-icon">🕐</span>
                    Selecciona una hora
                </h2>

                <div class="selected-date-display">
                    <div class="selected-date-text" id="selectedDateText"></div>
                </div>

                <div class="time-period">
                    <div class="period-title">
                        <span class="period-icon">🌅</span>
                        Mañana
                    </div>
                    <div class="time-slots-grid" id="morningSlots"></div>
                </div>

                <div class="time-period">
                    <div class="period-title">
                        <span class="period-icon">☀️</span>
                        Tarde
                    </div>
                    <div class="time-slots-grid" id="afternoonSlots"></div>
                </div>

                <div class="time-period">
                    <div class="period-title">
                        <span class="period-icon">🌙</span>
                        Noche
                    </div>
                    <div class="time-slots-grid" id="eveningSlots"></div>
                </div>
            </div>

            <!-- Selection Summary -->
            <div class="selection-summary" id="selectionSummary">
                <div class="summary-title">
                    ✓ Resumen de tu reserva
                </div>
                <div class="summary-row">
                    <div class="summary-label">📅 Fecha</div>
                    <div class="summary-value" id="summaryDate">-</div>
                </div>
                <div class="summary-row">
                    <div class="summary-label">🕐 Hora</div>
                    <div class="summary-value" id="summaryTime">-</div>
                </div>
                <div class="summary-row">
                    <div class="summary-label">✂️ Servicio</div>
                    <div class="summary-value" id="summaryService">-</div>
                </div>
                <div class="summary-row">
                    <div class="summary-label">💰 Precio</div>
                    <div class="summary-value" id="summaryPrice">-</div>
                </div>
            </div>
        </div>

        <!-- Fixed Bottom Bar -->
        <div class="fixed-bottom-bar">
            <button class="btn btn-primary" id="continueBtn" disabled>
                Continuar al Paso 2
            </button>
        </div>
    </div>

    <script>
        // Estado de la aplicación
        const state = {
            currentDate: new Date(),
            selectedDate: null,
            selectedTime: null,
            serviceInfo: null
        };

        // Configuración de horarios
        const timeSlots = {
            morning: ['09:00', '09:30', '10:00', '10:30', '11:00', '11:30'],
            afternoon: ['14:00', '14:30', '15:00', '15:30', '16:00', '16:30', '17:00', '17:30'],
            evening: ['18:00', '18:30', '19:00', '19:30', '20:00', '20:30']
        };

        // Horarios ocupados por fecha (simulación)
        const bookedSlots = {};

        // Nombres de meses en español
        const monthNames = [
            'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
            'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
        ];

        const dayNames = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];

        // Inicialización
        function init() {
            loadServiceInfo();
            renderCalendar();
            setupEventListeners();
            generateRandomBookedSlots();
        }

        // Cargar información del servicio - FUNCIÓN CORREGIDA
function loadServiceInfo() {
    const serviceInfo = JSON.parse(localStorage.getItem('selectedService'));
    console.log("Servicio cargado desde localStorage:", serviceInfo); // Para debug
    
    if (serviceInfo) {
        state.serviceInfo = serviceInfo;
        
        // Usar propiedades correctas del servicio
        const serviceName = serviceInfo.name || serviceInfo.service;
        const servicePrice = serviceInfo.formattedPrice || `$${serviceInfo.price.toLocaleString()}`;
        const serviceDuration = serviceInfo.duration;
        const serviceIcon = serviceInfo.icon;
        
        console.log("Nombre del servicio:", serviceName); // Para debug
        console.log("Precio del servicio:", servicePrice); // Para debug
        
        // Actualizar la interfaz
        document.getElementById('serviceIcon').textContent = serviceIcon;
        document.getElementById('serviceName').textContent = serviceName;
        document.getElementById('serviceDetails').textContent = `${serviceDuration} • Centro`;
        document.getElementById('servicePrice').textContent = servicePrice;
        
        // Actualizar resumen
        document.getElementById('summaryService').textContent = serviceName;
        document.getElementById('summaryPrice').textContent = servicePrice;
    } else {
        console.error('No se encontró información del servicio en localStorage');
        alert('Error: No se pudo cargar la información del servicio');
        window.location.href = 'Catalogo-servicios.html';
    }
}

        // Generar slots ocupados aleatorios
        function generateRandomBookedSlots() {
            const today = new Date();
            for (let i = 0; i < 30; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() + i);
                const dateKey = formatDateKey(date);
                
                const allSlots = [...timeSlots.morning, ...timeSlots.afternoon, ...timeSlots.evening];
                const numBooked = Math.floor(Math.random() * 8) + 2;
                bookedSlots[dateKey] = [];
                
                for (let j = 0; j < numBooked; j++) {
                    const randomSlot = allSlots[Math.floor(Math.random() * allSlots.length)];
                    if (!bookedSlots[dateKey].includes(randomSlot)) {
                        bookedSlots[dateKey].push(randomSlot);
                    }
                }
            }
        }

        // Renderizar calendario
        function renderCalendar() {
            const year = state.currentDate.getFullYear();
            const month = state.currentDate.getMonth();
            
            // Actualizar título del mes
            document.getElementById('monthYear').textContent = `${monthNames[month]} ${year}`;

            // Calcular días
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const prevLastDay = new Date(year, month, 0);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const firstDayWeek = firstDay.getDay();
            const lastDate = lastDay.getDate();
            const prevLastDate = prevLastDay.getDate();

            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';

            // Días del mes anterior
            for (let i = firstDayWeek; i > 0; i--) {
                const day = prevLastDate - i + 1;
                const dayEl = createDayElement(day, ['other-month'], null);
                calendarDays.appendChild(dayEl);
            }

            // Días del mes actual
            for (let day = 1; day <= lastDate; day++) {
                const date = new Date(year, month, day);
                date.setHours(0, 0, 0, 0);
                
                const classes = [];
                const isPast = date < today;
                const isToday = date.getTime() === today.getTime();
                const isSelected = state.selectedDate && date.getTime() === state.selectedDate.getTime();

                if (isPast) classes.push('disabled');
                if (isToday) classes.push('today');
                if (isSelected) classes.push('selected');

                const dayEl = createDayElement(day, classes, isPast ? null : date);
                calendarDays.appendChild(dayEl);
            }

            // Días del mes siguiente
            const totalCells = calendarDays.children.length;
            const remainingCells = totalCells % 7 === 0 ? 0 : 7 - (totalCells % 7);
            
            for (let i = 1; i <= remainingCells; i++) {
                const dayEl = createDayElement(i, ['other-month'], null);
                calendarDays.appendChild(dayEl);
            }

            // Actualizar estado de botones de navegación
            updateNavigationButtons();
        }

        // Crear elemento de día
        function createDayElement(day, classes, date) {
            const dayEl = document.createElement('div');
            dayEl.className = `calendar-day ${classes.join(' ')}`;
            dayEl.textContent = day;
            
            if (date && !classes.includes('disabled')) {
                dayEl.onclick = () => selectDate(date, dayEl);
                dayEl.setAttribute('role', 'button');
                dayEl.setAttribute('tabindex', '0');
            }
            
            return dayEl;
        }

        // Seleccionar fecha
        function selectDate(date) {
            state.selectedDate = new Date(date);
            state.selectedTime = null;
            
            renderCalendar();
            showTimeSlots();
            updateSummary();
        }

        // Mostrar horarios disponibles
        function showTimeSlots() {
            const card = document.getElementById('timeSlotsCard');
            const dateKey = formatDateKey(state.selectedDate);
            const booked = bookedSlots[dateKey] || [];

            // Actualizar texto de fecha seleccionada
            const dateText = formatLongDate(state.selectedDate);
            document.getElementById('selectedDateText').textContent = dateText;

            // Renderizar horarios
            renderTimeSlotsPeriod('morningSlots', timeSlots.morning, booked);
            renderTimeSlotsPeriod('afternoonSlots', timeSlots.afternoon, booked);
            renderTimeSlotsPeriod('eveningSlots', timeSlots.evening, booked);

            // Mostrar card con animación
            card.classList.add('active');
            
            // Scroll suave
            setTimeout(() => {
                card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        // Renderizar horarios de un período
        function renderTimeSlotsPeriod(containerId, slots, bookedSlots) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            slots.forEach(time => {
                const slot = document.createElement('div');
                slot.className = 'time-slot';
                slot.textContent = time;
                
                const isBooked = bookedSlots.includes(time);
                
                if (isBooked) {
                    slot.classList.add('disabled');
                } else {
                    slot.onclick = () => selectTime(time, slot);
                    slot.setAttribute('role', 'button');
                    slot.setAttribute('tabindex', '0');
                }
                
                container.appendChild(slot);
            });
        }

        // Seleccionar hora
        function selectTime(time, element) {
            state.selectedTime = time;
            
            // Remover selección anterior
            document.querySelectorAll('.time-slot.selected').forEach(slot => {
                slot.classList.remove('selected');
            });
            
            // Agregar selección actual
            element.classList.add('selected');
            
            updateSummary();
        }

        // Actualizar resumen
        function updateSummary() {
            const summary = document.getElementById('selectionSummary');
            const continueBtn = document.getElementById('continueBtn');
            
            if (state.selectedDate && state.selectedTime) {
                const dateStr = formatShortDate(state.selectedDate);
                
                document.getElementById('summaryDate').textContent = dateStr;
                document.getElementById('summaryTime').textContent = state.selectedTime;
                
                summary.classList.add('show');
                continueBtn.disabled = false;
                
                setTimeout(() => {
                    summary.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 200);
            } else {
                summary.classList.remove('show');
                continueBtn.disabled = true;
            }
        }

        // Actualizar botones de navegación
        function updateNavigationButtons() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const currentMonth = new Date(state.currentDate.getFullYear(), state.currentDate.getMonth(), 1);
            const todayMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            
            document.getElementById('prevMonth').disabled = currentMonth <= todayMonth;
        }

        // Event listeners
        function setupEventListeners() {
            document.getElementById('prevMonth').addEventListener('click', () => {
                state.currentDate.setMonth(state.currentDate.getMonth() - 1);
                renderCalendar();
            });

            document.getElementById('nextMonth').addEventListener('click', () => {
                state.currentDate.setMonth(state.currentDate.getMonth() + 1);
                renderCalendar();
            });

            // EVENT LISTENER CORREGIDO
            document.getElementById('continueBtn').addEventListener('click', () => {
                if (state.selectedDate && state.selectedTime && state.serviceInfo) {
                    // Guardar información de la cita en localStorage
                    const appointmentData = {
                        service: state.serviceInfo.name,
                        category: state.serviceInfo.category,
                        price: state.serviceInfo.formattedPrice || `$${state.serviceInfo.price.toLocaleString()}`,
                        duration: state.serviceInfo.duration,
                        icon: state.serviceInfo.icon,
                        date: state.selectedDate.toISOString(),
                        time: state.selectedTime,
                        stylist: "Ana María García",
                        location: "Calle 10 #5-30, Centro",
                        status: "upcoming"
                    };
                    
                    localStorage.setItem('appointmentData', JSON.stringify(appointmentData));
                    
                    // Redirigir a la página de confirmación
                    window.location.href = 'Resumen-Confirmación.html';
                }
            });
        }

        // Funciones de utilidad
        function formatDateKey(date) {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        }

        function formatLongDate(date) {
            return `${dayNames[date.getDay()]}, ${date.getDate()} de ${monthNames[date.getMonth()]} de ${date.getFullYear()}`;
        }

        function formatShortDate(date) {
            return `${date.getDate()} ${monthNames[date.getMonth()].substring(0, 3)} ${date.getFullYear()}`;
        }

        // Inicializar la aplicación
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>